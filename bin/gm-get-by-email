#!/usr/bin/env bash

ENV=$1
EMAIL=$2

src_file() {
    if [[ ! -f $1 ]]; then
      echo "missing '$1' file"
      exit 1
    fi
    source $1
}

case $ENV in
  'prod' | 'p')
    src_file ~/bin/.env.gm.prod
    ;;
  *)
    echo "unknown env '$1'; use [p]rod or [s]tage"
    exit 1
    ;;
esac

src_file ~/bin/.env.gm.urls

TOKEN=$(curl -s -X 'POST' $GYM_AUTH \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d "{ \"username\": \"$GYM_V6_AUTH_USER\", \"password\": \"$GYM_V6_AUTH_PASSWORD\", \"apiLicense\": \"$GYM_LICENSE\" }" \
  | jq '.data' | xargs)

if [[ "$TOKEN" == null ]]; then
  echo "could not log in!"
  exit 1
fi

MEMBERSHIPS=$(curl -s -X 'GET' $GYM_MEMBER_BY_EMAIL \
  -H 'accept: application/json' \
  -H "Authorization: $TOKEN" )

echo "member info received:"
echo $MEMBERSHIPS | jq
